# üìä –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–∞—Ä—Å–∏–Ω–≥—É SPP

## üöÄ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### 1. **–§–æ–Ω–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)**
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **1 —Ä–∞–∑ –≤ –¥–µ–Ω—å** –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ 12:00)
- –ü–∞—Ä—Å–∏—Ç –≤—Å–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∞—Ä—Ç–∏–∫—É–ª—ã —á–µ—Ä–µ–∑ –≤—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ SPP –∏ dest
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### 2. **–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫** (–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)
- –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ API

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í —Ñ–∞–π–ª–µ `.env` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```env
# –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Ñ–æ–Ω–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥
PARSING_ENABLED=true

# –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ (—á–∞—Å –∏ –º–∏–Ω—É—Ç–∞)
PARSING_SCHEDULE_HOUR=12
PARSING_SCHEDULE_MINUTE=0

# Headless —Ä–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞
PARSING_HEADLESS=true
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

```bash
python run.py
```

–í—ã —É–≤–∏–¥–∏—Ç–µ:
```
üìÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ 12:00 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∑–∞–ø—É—â–µ–Ω
```

### –®–∞–≥ 4: –î–æ–±–∞–≤—å—Ç–µ –∞—Ä—Ç–∏–∫—É–ª –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞

**POST** `/api/v1/articles/add`

```json
{
  "article_id": "15526304"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "uuid": "...",
  "article_id": "15526304",
  "created_at": "..."
}
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞—Ä—Å–∏–Ω–≥

**–í–∞—Ä–∏–∞–Ω—Ç A - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –ü—Ä–æ—Å—Ç–æ –¥–æ–∂–¥–∏—Ç–µ—Å—å –ø–ª–∞–Ω–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (12:00)

**–í–∞—Ä–∏–∞–Ω—Ç B - –í—Ä—É—á–Ω—É—é:**

**POST** `/api/v1/articles/parse/now`

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "message": "–ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ",
  "total_parsed": 5
}
```

### –®–∞–≥ 6: –ü–æ–ª—É—á–∏—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É

**GET** `/api/v1/articles/{article_id}/link`

–ù–∞–ø—Ä–∏–º–µ—Ä: `/api/v1/articles/15526304/link`

**–û—Ç–≤–µ—Ç:**
```json
{
  "article_id": "15526304",
  "generated_url": "https://card.wb.ru/cards/v4/detail?appType=1&curr=rub&dest=123585633&spp=42&hide_dtype=11&ab_testing=false&lang=ru&nm=15526304",
  "most_common_spp": 42.5,
  "most_common_dest": "123585633",
  "total_parses": 5,
  "last_updated": "2024-10-09T12:30:00"
}
```

## üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

1. **–ü–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ –∞–∫–∫–∞—É–Ω—Ç—ã**
   - –°–∏—Å—Ç–µ–º–∞ –±–µ—Ä–µ—Ç –∫–∞–∂–¥—ã–π –∞—Ä—Ç–∏–∫—É–ª
   - –ó–∞—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –∫–∞–∂–¥—ã–π –∞–∫–∫–∞—É–Ω—Ç (—Å –µ–≥–æ cookies)
   - –°–æ–±–∏—Ä–∞–µ—Ç SPP –∏ dest –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

2. **–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö**
   - –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π SPP
   - –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π dest
   - –í—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏**
   - –°–æ–∑–¥–∞–µ—Ç —Å—Å—ã–ª–∫—É —Å —Å–∞–º—ã–º–∏ —á–∞—Å—Ç—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
   - –≠—Ç–∞ —Å—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π

## üîÑ API Endpoints

### –ê—Ä—Ç–∏–∫—É–ª—ã:

- `POST /api/v1/articles/add` - –î–æ–±–∞–≤–∏—Ç—å –∞—Ä—Ç–∏–∫—É–ª
- `GET /api/v1/articles/list` - –°–ø–∏—Å–æ–∫ –∞—Ä—Ç–∏–∫—É–ª–æ–≤
- `GET /api/v1/articles/{id}/link` - –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É

### –ü–∞—Ä—Å–∏–Ω–≥:

- `POST /api/v1/articles/parse/now` - –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ —Å–µ–π—á–∞—Å
- `GET /api/v1/articles/schedule/status` - –°—Ç–∞—Ç—É—Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

## üìÅ –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ

```
data/
‚îú‚îÄ‚îÄ accounts.json          # –ê–∫–∫–∞—É–Ω—Ç—ã —Å cookies
‚îú‚îÄ‚îÄ articles.json          # –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∞—Ä—Ç–∏–∫—É–ª—ã
‚îú‚îÄ‚îÄ parsing_results.json   # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–æ–≤
‚îî‚îÄ‚îÄ analytics.json         # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Å—ã–ª–∫–∏
```

## üîç –õ–æ–≥–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞

–í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
üöÄ –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤—Å–µ—Ö –∞—Ä—Ç–∏–∫—É–ª–æ–≤...
üì¶ –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä—Ç–∏–∫—É–ª–∞ 15526304...
üîç –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä—Ç–∏–∫—É–ª–∞ 15526304 —á–µ—Ä–µ–∑ –∞–∫–∫–∞—É–Ω—Ç 310c8be7...
‚úÖ Brand | 1299.00‚ÇΩ –∏–∑ 2599.00‚ÇΩ (SPP 50.02%) | dest=123585633 | qty=100
üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è 15526304: SPP=50.02, dest=123585633
‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 5 –∑–∞–ø–∏—Å–µ–π
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

**–ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞:**

`.env`:
```env
PARSING_SCHEDULE_HOUR=14    # 14:00
PARSING_SCHEDULE_MINUTE=30  # 14:30
```

**–û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥:**

```env
PARSING_ENABLED=false
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

**GET** `/api/v1/articles/schedule/status`

```json
{
  "enabled": true,
  "schedule_hour": 12,
  "schedule_minute": 0,
  "headless": true,
  "schedule_description": "–ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 12:00"
}
```

## üéØ –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# 1. –î–æ–±–∞–≤–∏—Ç—å –∞—Ä—Ç–∏–∫—É–ª
curl -X POST http://localhost:8000/api/v1/articles/add \
  -H "Content-Type: application/json" \
  -d '{"article_id": "15526304"}'

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥
curl -X POST http://localhost:8000/api/v1/articles/parse/now

# 3. –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É
curl http://localhost:8000/api/v1/articles/15526304/link
```

## ‚ùì FAQ

**Q: –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–∞—Ä—Å–∏–Ω–≥?**
A: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 12:00. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `.env`

**Q: –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–∞—Ä—Å–∏—Ç—Å—è –∫–∞–∂–¥—ã–π –∞—Ä—Ç–∏–∫—É–ª?**
A: –°—Ç–æ–ª—å–∫–æ —Ä–∞–∑, —Å–∫–æ–ª—å–∫–æ —É –≤–∞—Å –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (–∫–∞–∂–¥—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–∞–µ—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å)

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞?**
A: –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –≤—Ä—É—á–Ω—É—é?**
A: –î–∞, —á–µ—Ä–µ–∑ `POST /api/v1/articles/parse/now`

---

**–í–µ—Ä—Å–∏—è**: 1.0  
**–î–∞—Ç–∞**: 09.10.2024

